<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Gauntlet: Agility Assault</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    :root {
      --primary: #06b6d4; /* Electric Cyan */
      --primary-dark: #0891b2;
      --bg-dark: #0f172a; /* Slate 900 */
      --surface: #1e293b; /* Slate 800 */
      --surface-light: #334155;
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
    }

    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: var(--bg-dark);
      color: var(--text-main);
      min-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    html {
      height: 100%;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }
    
    /* Global Styles Update */
    h1 { color: var(--primary); margin: 0 0 8px 0; font-size: 32px; font-weight: 800; letter-spacing: -0.5px; }
    h2 { color: #e2e8f0; margin: 0 0 24px 0; font-size: 24px; font-weight: 600; }
    .subtitle { color: var(--text-muted); margin-bottom: 32px; font-size: 16px; }
    
    /* Cards */
    .auth-card, .main-content, .landing-page {
      background: var(--surface);
      border-radius: 24px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255,255,255,0.05);
    }
    .auth-card { padding: 40px; max-width: 400px; margin: 0 auto; }
    .main-content { padding: 32px; }
    .landing-page { padding: 0; overflow: hidden; max-width: 1000px; margin: 0 auto; }

    /* Forms */
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; color: #cbd5e1; font-weight: 500; font-size: 14px; }
    input[type="text"], input[type="email"] {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-dark);
      border: 2px solid var(--surface-light);
      border-radius: 12px;
      font-size: 16px;
      color: white;
      transition: all 0.2s;
      box-sizing: border-box;
    }
    input[type="text"]:focus, input[type="email"]:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.1);
    }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 16px 24px;
      background: var(--primary);
      color: var(--bg-dark);
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .btn:hover { background: var(--primary-dark); transform: translateY(-1px); }
    .btn:disabled { background: var(--surface-light); color: var(--text-muted); cursor: not-allowed; }
    
    .btn-secondary {
      background: var(--surface-light);
      color: #e2e8f0;
      margin-top: 12px;
      text-transform: none;
      font-weight: 600;
    }
    .btn-secondary:hover { background: #475569; }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--surface-light);
    }
    .user-info { color: var(--text-muted); font-size: 14px; }
    .user-name { font-weight: 700; color: var(--primary); }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--surface-light);
      flex-wrap: wrap;
    }
    .tab {
      padding: 12px 24px;
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }
    .tab.active { color: var(--primary); border-bottom-color: var(--primary); }
    .tab:hover { color: #e2e8f0; }

    /* Workouts */
    .day-card {
      background: var(--bg-dark);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 16px;
      border: 1px solid var(--surface-light);
    }
    .day-header {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .workout-item {
      background: var(--surface);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      border: 1px solid transparent;
      transition: all 0.2s;
    }
    .workout-item:hover { border-color: var(--primary-dark); transform: translateY(-2px); }
    .workout-item.completed {
      background: rgba(6, 182, 212, 0.05);
      border-color: rgba(6, 182, 212, 0.3);
    }
    
    .workout-header { display: flex; align-items: flex-start; gap: 16px; width: 100%; }
    .checkbox-container { flex-shrink: 0; padding-top: 2px; }
    
    /* Custom Checkbox */
    input[type="checkbox"] {
      appearance: none;
      width: 24px;
      height: 24px;
      background: var(--bg-dark);
      border: 2px solid var(--surface-light);
      border-radius: 6px;
      cursor: pointer;
      position: relative;
    }
    input[type="checkbox"]:checked {
      background: var(--primary);
      border-color: var(--primary);
    }
    input[type="checkbox"]:checked::after {
      content: '‚úì';
      position: absolute;
      color: var(--bg-dark);
      font-size: 16px;
      font-weight: bold;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .workout-info { flex: 1; }
    .workout-title { font-weight: 700; color: #f8fafc; margin-bottom: 8px; font-size: 18px; }
    .workout-details { display: flex; gap: 12px; flex-wrap: wrap; font-size: 13px; color: var(--text-muted); align-items: center; }
    
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .badge-weights { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
    .badge-bodyweight { background: rgba(6, 182, 212, 0.2); color: #22d3ee; }
    
    .video-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 12px;
      background: #000;
      margin-top: 4px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
    
    .completed-date { font-size: 12px; color: var(--primary); font-weight: 600; margin-top: 8px; display: flex; align-items: center; gap: 4px; }

    /* Progress */
    .progress-section {
      background: rgba(15, 23, 42, 0.5);
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 24px;
      border: 1px solid var(--surface-light);
    }
    .progress-bar-container {
      background: var(--bg-dark);
      height: 16px;
      border-radius: 8px;
      overflow: hidden;
      margin-top: 12px;
      border: 1px solid var(--surface-light);
    }
    .progress-bar {
      background: linear-gradient(90deg, var(--primary) 0%, #3b82f6 100%);
      height: 100%;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 12px rgba(6, 182, 212, 0.5);
    }

    /* Landing Page Hero */
    .hero-section {
      text-align: center;
      padding: 80px 20px;
      background: linear-gradient(180deg, rgba(15,23,42,0) 0%, rgba(6,182,212,0.1) 100%);
      border-bottom: 1px solid var(--surface-light);
      position: relative;
      overflow: hidden;
    }
    
    /* New Logo Visual */
    .logo-visual {
      width: 120px;
      height: 120px;
      background: linear-gradient(135deg, var(--primary) 0%, #3b82f6 100%);
      border-radius: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 32px;
      transform: rotate(-3deg);
      box-shadow: 0 0 40px rgba(6, 182, 212, 0.4);
    }
    .logo-icon { width: 64px; height: 64px; fill: white; }
    
    .hero-title {
      font-size: 56px;
      font-weight: 900;
      background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: -2px;
      line-height: 1;
    }
    .hero-subtitle { font-size: 20px; color: var(--text-muted); margin-bottom: 40px; max-width: 600px; margin-left: auto; margin-right: auto; }
    
    .btn-hero {
      font-size: 20px;
      padding: 20px 60px;
      box-shadow: 0 10px 30px -10px var(--primary);
      width: auto;
      display: inline-block;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 32px;
      padding: 60px 40px;
    }
    .feature-card {
      background: var(--bg-dark);
      border-radius: 20px;
      padding: 32px;
      text-align: center;
      border: 1px solid var(--surface-light);
      transition: all 0.3s;
    }
    .feature-card:hover {
      transform: translateY(-8px);
      border-color: var(--primary);
      box-shadow: 0 12px 30px -10px rgba(6, 182, 212, 0.2);
    }
    .feature-icon { font-size: 40px; margin-bottom: 20px; display: inline-block; padding: 16px; background: rgba(255,255,255,0.05); border-radius: 50%; }
    
    /* CTA */
    .cta-section {
      text-align: center;
      padding: 80px 20px;
      background: linear-gradient(135deg, var(--surface) 0%, #0f172a 100%);
      margin: 40px;
      border-radius: 24px;
      border: 1px solid var(--surface-light);
    }

    /* Hall of Fame */
    .hall-of-fame {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      padding: 32px;
      border-radius: 20px;
      margin-bottom: 32px;
      border: 1px solid var(--primary);
      position: relative;
      overflow: hidden;
    }
    .hall-of-fame::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; height: 4px;
      background: linear-gradient(90deg, var(--primary), #3b82f6);
    }
    .hall-member {
      background: rgba(255,255,255,0.05);
      color: white;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .hall-title { color: var(--primary); text-transform: uppercase; letter-spacing: 2px; }

    /* Certificate */
    .certificate {
      background: #fff;
      color: #0f172a;
      border: 12px solid var(--primary);
    }
    .certificate h2, .certificate h3 { color: #0f172a; }
    .certificate-text { color: #475569; }
    .certificate-badge { font-size: 100px; }
    
    .hidden { display: none !important; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div id="landingScreen" class="landing-page">
    <div class="hero-section">
      <div class="logo-visual">
        <svg class="logo-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M13.5 2C13.5 2.82843 12.8284 3.5 12 3.5C11.1716 3.5 10.5 2.82843 10.5 2H13.5ZM12 22C17.5228 22 22 17.5228 22 12H19C19 15.866 15.866 19 12 19V22ZM2 12C2 17.5228 6.47715 22 12 22V19C8.13401 19 5 15.866 5 12H2ZM12 5C8.13401 5 5 8.13401 5 12H2C2 6.47715 6.47715 2 12 2V5ZM15.5 10.5L11.2071 14.7929L9.79289 13.3787L14.0858 9.08579L15.5 10.5Z"/>
          <path d="M12 5V8" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M19 12L16 12" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M12 19V16" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M5 12L8 12" stroke="white" stroke-width="2" stroke-linecap="round"/>
          <path d="M17 7L15 9" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      
     <h1 class="hero-title" id="heroTitle">The Gauntlet:<br>Agility Assault</h1>
     <p class="hero-subtitle">Speed. Precision. Endurance. The ultimate 4-week bodyweight & mobility challenge.</p>
     <button class="btn btn-hero" id="getStartedBtn">Start The Assault</button>
    </div>
    
    <div class="features-grid">
     <div class="feature-card">
      <div class="feature-icon">‚ö°</div>
      <h3 class="feature-title">High Octane</h3>
      <p class="feature-description">Fast-paced workouts designed to spike your heart rate and torch calories.</p>
     </div>
     <div class="feature-card">
      <div class="feature-icon">üå™Ô∏è</div>
      <h3 class="feature-title">Agility Focus</h3>
      <p class="feature-description">Unlock new levels of movement with targeted mobility and coordination drills.</p>
     </div>
     <div class="feature-card">
      <div class="feature-icon">üõ°Ô∏è</div>
      <h3 class="feature-title">Battle Ready</h3>
      <p class="feature-description">Build functional strength that translates directly to real-world performance.</p>
     </div>
     <div class="feature-card">
      <div class="feature-icon">üèÜ</div>
      <h3 class="feature-title">Hall of Fame</h3>
      <p class="feature-description">Earn your spot among the elite warriors who survived the assault.</p>
     </div>
    </div>
    
    <div class="cta-section">
     <h2 class="cta-title">Ready to Test Your Limits?</h2>
     <p class="cta-text">The clock is ticking. Are you fast enough?</p>
     <button class="btn btn-cta" id="ctaBtn">Join the Ranks</button>
     <div style="margin-top: 24px;">
       <a href="https://www.canva.com" target="_blank" rel="noopener noreferrer" class="btn btn-secondary" style="display: inline-block; text-decoration: none; width: auto; padding: 12px 24px;">Join Monthly 200K Step Challenge üö∂‚Äç‚ôÇÔ∏è</a>
     </div>
    </div>
   </div>

   <div id="authScreen" class="auth-card hidden">
    <div style="text-align: center; margin-bottom: 24px;">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="var(--primary)"><path d="M13.5 2C13.5 2.82843 12.8284 3.5 12 3.5C11.1716 3.5 10.5 2.82843 10.5 2H13.5ZM12 22C17.5228 22 22 17.5228 22 12H19C19 15.866 15.866 19 12 19V22ZM2 12C2 17.5228 6.47715 22 12 22V19C8.13401 19 5 15.866 5 12H2ZM12 5C8.13401 5 5 8.13401 5 12H2C2 6.47715 6.47715 2 12 2V5Z"/></svg>
    </div>
    <h1 id="appTitle" style="text-align: center;">Agility Assault</h1>
    <p class="subtitle" id="welcomeMessage" style="text-align: center;">Sign in to track your performance</p>
    <form id="authForm">
     <div class="form-group"><label for="userName">Warrior Name</label> <input type="text" id="userName" required placeholder="Enter your name">
     </div>
     <div class="form-group"><label for="userEmail">Email Address</label> <input type="email" id="userEmail" required placeholder="Enter your email">
     </div><button type="submit" class="btn" id="signInBtn">Begin Challenge</button> <button type="button" class="btn btn-secondary" id="backToLandingBtn">‚Üê Back</button>
    </form>
   </div>

   <div id="mainScreen" class="main-content hidden">
    <div class="header">
     <div>
      <h1 id="mainTitle">Agility Assault</h1>
      <p class="user-info">Agent: <span class="user-name" id="displayUserName"></span></p>
     </div>
     <div style="display: flex; gap: 12px;"><button class="btn-secondary" id="homeBtn" style="width: auto; padding: 10px 20px;">‚Üê Home</button> <button class="btn-secondary" id="signOutBtn" style="width: auto; padding: 10px 20px;">Sign Out</button>
     </div>
    </div>
    
    <div id="hallOfFameSection" class="hall-of-fame">
     <h2 class="hall-title">‚ö° Speed Demons (Hall of Fame) ‚ö°</h2>
     <p class="hall-subtitle" style="text-align: center; color: var(--text-muted); margin-bottom: 20px;">Elite warriors who completed the course</p>
     <div class="hall-list" id="hallList">
      <div class="no-champions">
       Be the first to cross the finish line!
      </div>
     </div>
     <div class="hall-pagination hidden" id="hallPagination"><button class="page-btn" id="prevPageBtn">‚Üê Previous</button> <span class="page-info" id="pageInfo" style="color: white;">Page 1</span> <button class="page-btn" id="nextPageBtn">Next ‚Üí</button>
     </div>
    </div>
    
    <div class="progress-section">
     <h2 style="margin: 0 0 8px 0; font-size: 18px; color: white;">Mission Progress</h2>
     <p class="progress-text" id="progressText">0 of 0 missions completed</p>
     <div class="progress-bar-container">
      <div class="progress-bar" id="progressBar" style="width: 0%"></div>
     </div>
    </div>
    
    <div class="tabs"><button class="tab active" data-week="1">Week 1</button> <button class="tab" data-week="2">Week 2</button> <button class="tab" data-week="3">Week 3</button> <button class="tab" data-week="4">Week 4</button>
    </div>
    
    <div id="workoutContent">
     <div class="loading">
      Initializing mission data...
     </div>
    </div>
   </div>

   <div id="certificateModal" class="certificate-modal hidden">
    <div class="certificate">
     <div class="certificate-badge">
      ‚ö°
     </div>
     <h2 class="certificate-heading" id="certificateHeading">Mission Accomplished</h2>
     <p class="certificate-subheading">Official Commendation</p>
     <h3 class="certificate-name" id="certificateName">Warrior Name</h3>
     <p class="certificate-text">Has successfully survived <strong>The Gauntlet: Agility Assault</strong><br>
       completing all high-intensity operations with<br>
       exceptional speed, endurance, and discipline.</p>
     <p class="certificate-date" id="certificateDate">Completed on: January 1, 2024</p><button class="certificate-close" id="closeCertificateBtn">Dismiss</button>
    </div>
   </div>
  </div>
  
  <script>
    // Updated Workout Data for Agility Assault
    const workoutProgram = [
      // Week 1
      {week: 1, day: 1, bodyArea: "Upper Body Assault", videoLink: "https://youtu.be/9wx2pPM4IDw", trainer: "HR", duration: "35 min", requiresWeights: true},
      {week: 1, day: 1, bodyArea: "Full Body Igniter", videoLink: "https://youtu.be/J212vz33gU4", trainer: "OS", duration: "15 min", requiresWeights: false},
      {week: 1, day: 2, bodyArea: "Lower Body Agility", videoLink: "https://youtu.be/LWV8lMPBtiE", trainer: "FK", duration: "40 min", requiresWeights: true},
      {week: 1, day: 2, bodyArea: "Full Body Speed", videoLink: "https://youtu.be/JFzEp-wwRKk", trainer: "BJ", duration: "15 min", requiresWeights: false},
      {week: 1, day: 3, bodyArea: "Upper Body Power", videoLink: "https://www.youtube.com/watch?v=s0Qbxm3gUso", trainer: "GA", duration: "40 min", requiresWeights: true},
      {week: 1, day: 3, bodyArea: "Core Stabilizer", videoLink: "https://www.youtube.com/watch?v=QUW5juyHLkg", trainer: "DHM", duration: "10 min", requiresWeights: false},
      {week: 1, day: 4, bodyArea: "Lower Body Drive", videoLink: "https://youtu.be/l5px6GbSBV8", trainer: "AP", duration: "30 min", requiresWeights: true},
      {week: 1, day: 4, bodyArea: "Full Body Burn", videoLink: "https://youtu.be/4auucb8pQic", trainer: "JH", duration: "20 min", requiresWeights: false},
      {week: 1, day: 5, bodyArea: "The Gauntlet Challenge", videoLink: "https://youtu.be/PJCXd0LoASQ", trainer: "JT", duration: "50 min", requiresWeights: true},
      {week: 1, day: 6, bodyArea: "Rest Day", videoLink: "", trainer: "", duration: "0 min", requiresWeights: false},
      {week: 1, day: 7, bodyArea: "Rest Day", videoLink: "", trainer: "", duration: "0 min", requiresWeights: false},

      // Week 2
      {week: 2, day: 1, bodyArea: "Full Body Tactical", videoLink: "https://youtu.be/ImlVTRJMX2s", trainer: "SC", duration: "20 min", requiresWeights: true},
      {week: 2, day: 1, bodyArea: "Speed Drills", videoLink: "https://youtu.be/sotEYDlY7o8", trainer: "JY", duration: "25 min", requiresWeights: false},
      {week: 2, day: 2, bodyArea: "Lower Body Strength", videoLink: "https://youtu.be/oEI2oV6RP_8", trainer: "FK", duration: "30 min", requiresWeights: true},
      {week: 2, day: 2, bodyArea: "Full Body Mobility", videoLink: "https://youtu.be/PFK9eQqdmuU", trainer: "AT", duration: "20 min", requiresWeights: false},
      {week: 2, day: 3, bodyArea: "Endurance Ops", videoLink: "https://youtu.be/aAssb5NnpE4", trainer: "TD", duration: "40 min", requiresWeights: false},
      {week: 2, day: 4, bodyArea: "Upper Body Siege", videoLink: "https://youtu.be/s0Qbxm3gUso", trainer: "GA", duration: "40 min", requiresWeights: true},
      {week: 2, day: 4, bodyArea: "Core Armor", videoLink: "https://youtu.be/3U_TXBVnW2A", trainer: "TD", duration: "10 min", requiresWeights: false},
      {week: 2, day: 5, bodyArea: "Full Body Assault", videoLink: "https://youtu.be/uu4T2CTplek", trainer: "FK", duration: "50 min", requiresWeights: true},
      {week: 2, day: 6, bodyArea: "Rest Day", videoLink: "", trainer: "", duration: "0 min", requiresWeights: false},
      {week: 2, day: 7, bodyArea: "Rest Day", videoLink: "", trainer: "", duration: "0 min", requiresWeights: false},

      // Week 3
      {week: 3, day: 1, bodyArea: "Upper Body Blitz", videoLink: "https://youtu.be/nixaLRF0Jd8", trainer: "OS", duration: "20 min", requiresWeights: true},
      {week: 3, day: 1, bodyArea: "Upper Body Flow", videoLink: "https://youtu.be/mm47bCaCzpQ", trainer: "BJ", duration: "20 min", requiresWeights: false},
      {week: 3, day: 2, bodyArea: "Lower Body Explosive", videoLink: "https://youtu.be/0YCRcnhd4I0", trainer: "HR", duration: "20 min", requiresWeights: true},
      {week: 3, day: 2, bodyArea: "Full Body Combat", videoLink: "https://youtu.be/_fsmV9Uaz0c", trainer: "DHM", duration: "30 min", requiresWeights: true},
      {week: 3, day: 3, bodyArea: "Upper Body Tech", videoLink: "https://youtu.be/JBz2dILOVlc", trainer: "AT", duration: "20 min", requiresWeights: false},
      {week: 3, day: 3, bodyArea: "Full Body Rush", videoLink: "https://youtu.be/3p35bBbxNTk", trainer: "NBD", duration: "25 min", requiresWeights: false},
      {week: 3, day: 4, bodyArea: "Upper Body Max", videoLink: "https://youtu.be/fJQmoPKvjTg", trainer: "T&D", duration: "30 min", requiresWeights: true},
      {week: 3, day: 4, bodyArea: "Full Body Finisher", videoLink: "https://youtu.be/KNFbXsO5J5U", trainer: "JH", duration: "20 min", requiresWeights: false},
      {week: 3, day: 5, bodyArea: "The Gauntlet V2", videoLink: "https://youtu.be/UmIq-LeOoDo", trainer: "FK", duration: "45 min", requiresWeights: true},
      {week: 3, day: 6, bodyArea: "Rest Day", videoLink: "", trainer: "", duration: "0 min", requiresWeights: false},
      {week: 3, day: 7, bodyArea: "Rest Day", videoLink: "", trainer: "", duration: "0 min", requiresWeights: false},

      // Week 4
      {week: 4, day: 1, bodyArea: "Upper Body Elite", videoLink: "https://youtu.be/4gX0SWUiV9k", trainer: "GA", duration: "40 min", requiresWeights: true},
      {week: 4, day: 2, bodyArea: "Lower Body Elite", videoLink: "https://youtu.be/e39eoxw9KkM", trainer: "TD", duration: "40 min", requiresWeights: true},
      {week: 4, day: 3, bodyArea: "Full Body Elite", videoLink: "https://youtu.be/gDIbf555o4k", trainer: "GA", duration: "40 min", requiresWeights: false},
      {week: 4, day: 4, bodyArea: "Full Body Survival", videoLink: "https://youtu.be/M6coc7feAcU", trainer: "TD", duration: "35 min", requiresWeights: true},
      {week: 4, day: 4, bodyArea: "Upper Body Final", videoLink: "https://youtu.be/yC-AsuvS0Sc", trainer: "BJ", duration: "15 min", requiresWeights: true},
      {week: 4, day: 5, bodyArea: "THE FINAL ASSAULT", videoLink: "https://youtu.be/HzfHKN6rmpk", trainer: "BJ", duration: "45 min", requiresWeights: false},
      {week: 4, day: 6, bodyArea: "Rest Day", videoLink: "", trainer: "", duration: "0 min", requiresWeights: false},
      {week: 4, day: 7, bodyArea: "Rest Day", videoLink: "", trainer: "", duration: "0 min", requiresWeights: false}
    ];

    const defaultConfig = {
      app_title: "The Gauntlet: Agility Assault",
      welcome_message: "Sign in to begin your challenge and track your progress",
      certificate_title: "Mission Accomplished",
      background_color: "#0f172a",
      surface_color: "#1e293b",
      text_color: "#f8fafc",
      primary_action_color: "#06b6d4",
      secondary_action_color: "#334155",
      font_family: "Inter",
      font_size: 16
    };

    let currentUser = null;
    let userProgress = [];
    let allData = [];
    let currentPage = 0;
    const ITEMS_PER_PAGE = 5;

    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        if (!currentUser) return;
        userProgress = data.filter(record => record.user_email === currentUser.email);
        updateWorkoutDisplay();
        updateProgress();
        updateHallOfFame();
      }
    };

    async function init() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize Data SDK");
      }
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const appTitle = config.app_title || defaultConfig.app_title;
            const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;
            const certificateTitle = config.certificate_title || defaultConfig.certificate_title;
            
            document.getElementById('appTitle').textContent = appTitle;
            document.getElementById('mainTitle').textContent = appTitle;
            // Update Hero Title with line break
            document.getElementById('heroTitle').innerHTML = appTitle.replace(': ', ':<br>');
            document.getElementById('welcomeMessage').textContent = welcomeMessage;
            document.getElementById('certificateHeading').textContent = certificateTitle;
          },
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: {},
            fontSizeable: {}
          }),
          mapToEditPanelValues: (config) => new Map([
            ["app_title", config.app_title || defaultConfig.app_title],
            ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
            ["certificate_title", config.certificate_title || defaultConfig.certificate_title]
          ])
        });
      }
    }

    function updateHallOfFame() {
      const champions = {};
      
      allData.forEach(record => {
        if (record.challenge_completed && record.user_name) {
          if (!champions[record.user_email]) {
            champions[record.user_email] = {
              name: record.user_name,
              date: record.completion_date
            };
          }
        }
      });
      
      const championList = Object.values(champions).sort((a, b) => {
        return new Date(a.date) - new Date(b.date);
      });
      
      const hallList = document.getElementById('hallList');
      const pagination = document.getElementById('hallPagination');
      
      if (championList.length === 0) {
        hallList.innerHTML = '<div class="no-champions">Be the first to cross the finish line!</div>';
        pagination.classList.add('hidden');
        return;
      }
      
      const totalPages = Math.ceil(championList.length / ITEMS_PER_PAGE);
      const start = currentPage * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageChampions = championList.slice(start, end);
      
      hallList.innerHTML = pageChampions.map((champion, index) => {
        const globalIndex = start + index + 1;
        return `<div class="hall-member">üèÜ ${globalIndex}. ${champion.name}</div>`;
      }).join('');
      
      pagination.classList.remove('hidden');
      document.getElementById('pageInfo').textContent = `Page ${currentPage + 1} of ${totalPages}`;
      document.getElementById('prevPageBtn').disabled = currentPage === 0;
      document.getElementById('nextPageBtn').disabled = currentPage >= totalPages - 1;
    }

    document.getElementById('prevPageBtn').addEventListener('click', () => {
      if (currentPage > 0) {
        currentPage--;
        updateHallOfFame();
      }
    });

    document.getElementById('nextPageBtn').addEventListener('click', () => {
      const champions = Object.values(allData.reduce((acc, record) => {
        if (record.challenge_completed && record.user_name && !acc[record.user_email]) {
          acc[record.user_email] = true;
        }
        return acc;
      }, {}));
      const totalPages = Math.ceil(champions.length / ITEMS_PER_PAGE);
      
      if (currentPage < totalPages - 1) {
        currentPage++;
        updateHallOfFame();
      }
    });

    document.getElementById('getStartedBtn').addEventListener('click', () => {
      document.getElementById('landingScreen').classList.add('hidden');
      document.getElementById('authScreen').classList.remove('hidden');
    });

    document.getElementById('ctaBtn').addEventListener('click', () => {
      document.getElementById('landingScreen').classList.add('hidden');
      document.getElementById('authScreen').classList.remove('hidden');
    });

    document.getElementById('backToLandingBtn').addEventListener('click', () => {
      document.getElementById('authScreen').classList.add('hidden');
      document.getElementById('landingScreen').classList.remove('hidden');
      document.getElementById('authForm').reset();
    });

    document.getElementById('authForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = document.getElementById('signInBtn');
      btn.disabled = true;
      btn.textContent = 'Authenticating...';
      
      const name = document.getElementById('userName').value.trim();
      const email = document.getElementById('userEmail').value.trim().toLowerCase();
      
      currentUser = { name, email };
      
      userProgress = allData.filter(record => record.user_email === email);
      
      document.getElementById('authScreen').classList.add('hidden');
      document.getElementById('mainScreen').classList.remove('hidden');
      document.getElementById('displayUserName').textContent = name;
      
      updateWorkoutDisplay();
      updateProgress();
      updateHallOfFame();
      
      btn.disabled = false;
      btn.textContent = 'Begin Challenge';
    });

    document.getElementById('homeBtn').addEventListener('click', () => {
      document.getElementById('mainScreen').classList.add('hidden');
      document.getElementById('landingScreen').classList.remove('hidden');
    });

    document.getElementById('signOutBtn').addEventListener('click', () => {
      currentUser = null;
      userProgress = [];
      currentPage = 0;
      document.getElementById('landingScreen').classList.remove('hidden');
      document.getElementById('mainScreen').classList.add('hidden');
      document.getElementById('authForm').reset();
    });

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        updateWorkoutDisplay();
      });
    });

    function getYoutubeId(url) {
        if (!url) return null;
        const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
        const match = url.match(regExp);
        return (match && match[2].length === 11) ? match[2] : null;
    }

    function updateWorkoutDisplay() {
      const activeWeek = parseInt(document.querySelector('.tab.active').dataset.week);
      const weekWorkouts = workoutProgram.filter(w => w.week === activeWeek);
      
      const groupedByDay = {};
      weekWorkouts.forEach(workout => {
        if (!groupedByDay[workout.day]) {
          groupedByDay[workout.day] = [];
        }
        groupedByDay[workout.day].push(workout);
      });
      
      const content = document.getElementById('workoutContent');
      content.innerHTML = '';
      
      Object.keys(groupedByDay).sort((a, b) => a - b).forEach(day => {
        const dayCard = document.createElement('div');
        dayCard.className = 'day-card';
        
        const dayHeader = document.createElement('div');
        dayHeader.className = 'day-header';
        dayHeader.textContent = `Day ${day}`;
        dayCard.appendChild(dayHeader);
        
        groupedByDay[day].forEach((workout, workoutIndex) => {
          const workoutId = `w${workout.week}d${workout.day}_${workoutIndex}`;
          const progress = userProgress.find(p => 
            p.week === workout.week && 
            p.day === workout.day && 
            p.workout_id === workoutId
          );
          const isCompleted = progress?.completed || false;
          
          if (workout.bodyArea === "Rest Day") {
            const restItem = document.createElement('div');
            restItem.className = 'workout-item';
            restItem.innerHTML = `
              <div class="workout-info">
                <div class="workout-title">üåü Rest & Recovery</div>
                <div class="workout-details">
                  <span>Recharge your energy systems</span>
                </div>
              </div>
            `;
            dayCard.appendChild(restItem);
          } else {
            const videoId = getYoutubeId(workout.videoLink);
            const videoEmbed = videoId ? `
              <div class="video-container">
                <iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe>
              </div>
            ` : '';

            const workoutItem = document.createElement('div');
            workoutItem.className = `workout-item ${isCompleted ? 'completed' : ''}`;
            
            workoutItem.innerHTML = `
              <div class="workout-header">
                <div class="checkbox-container">
                  <input type="checkbox" ${isCompleted ? 'checked' : ''} data-week="${workout.week}" data-day="${workout.day}" data-id="${workoutId}">
                </div>
                <div class="workout-info">
                  <div class="workout-title">${workout.bodyArea}</div>
                  <div class="workout-details">
                    <span class="detail-item">üë§ ${workout.trainer}</span>
                    <span class="detail-item">‚è±Ô∏è ${workout.duration}</span>
                    <span class="badge ${workout.requiresWeights ? 'badge-weights' : 'badge-bodyweight'}">
                      ${workout.requiresWeights ? 'üèãÔ∏è Weights' : 'üí™ Bodyweight'}
                    </span>
                  </div>
                  ${isCompleted && progress.completed_date ? `<div class="completed-date"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Mission Complete: ${new Date(progress.completed_date).toLocaleDateString()}</div>` : ''}
                </div>
              </div>
              ${videoEmbed}
            `;
            
            const checkbox = workoutItem.querySelector('input[type="checkbox"]');
            checkbox.addEventListener('change', handleWorkoutToggle);
            
            dayCard.appendChild(workoutItem);
          }
        });
        
        content.appendChild(dayCard);
      });
    }

    async function handleWorkoutToggle(e) {
      const checkbox = e.target;
      const week = parseInt(checkbox.dataset.week);
      const day = parseInt(checkbox.dataset.day);
      const workoutId = checkbox.dataset.id;
      const isChecked = checkbox.checked;
      
      checkbox.disabled = true;
      
      const existingProgress = userProgress.find(p => 
        p.week === week && 
        p.day === day && 
        p.workout_id === workoutId
      );
      
      if (existingProgress) {
        const updated = {
          ...existingProgress,
          completed: isChecked,
          completed_date: isChecked ? new Date().toISOString() : null
        };
        const result = await window.dataSdk.update(updated);
        if (!result.isOk) {
          checkbox.checked = !isChecked;
        }
      } else {
        const newRecord = {
          id: `${currentUser.email}_${workoutId}_${Date.now()}`,
          user_email: currentUser.email,
          user_name: currentUser.name,
          week: week,
          day: day,
          workout_id: workoutId,
          completed: isChecked,
          completed_date: isChecked ? new Date().toISOString() : null,
          challenge_completed: false,
          completion_date: null
        };
        const result = await window.dataSdk.create(newRecord);
        if (!result.isOk) {
          checkbox.checked = !isChecked;
        }
      }
      
      checkbox.disabled = false;
    }

    function updateProgress() {
      const totalWorkouts = workoutProgram.filter(w => w.bodyArea !== "Rest Day").length;
      const completedWorkouts = userProgress.filter(p => p.completed).length;
      const percentage = totalWorkouts > 0 ? (completedWorkouts / totalWorkouts) * 100 : 0;
      
      document.getElementById('progressText').textContent = 
        `${completedWorkouts} of ${totalWorkouts} missions completed`;
      document.getElementById('progressBar').style.width = `${percentage}%`;
      
      if (completedWorkouts === totalWorkouts && totalWorkouts > 0) {
        checkChallengeCompletion();
      }
    }

    async function checkChallengeCompletion() {
      const alreadyCompleted = userProgress.some(p => p.challenge_completed);
      
      if (!alreadyCompleted) {
        const completionDate = new Date().toISOString();
        
        const completionRecord = {
          id: `${currentUser.email}_completion_${Date.now()}`,
          user_email: currentUser.email,
          user_name: currentUser.name,
          week: 0,
          day: 0,
          workout_id: 'challenge_complete',
          completed: true,
          completed_date: completionDate,
          challenge_completed: true,
          completion_date: completionDate
        };
        
        const result = await window.dataSdk.create(completionRecord);
        
        if (result.isOk) {
          showCertificate();
        }
      }
    }

    function showCertificate() {
      const modal = document.getElementById('certificateModal');
      document.getElementById('certificateName').textContent = currentUser.name;
      document.getElementById('certificateDate').textContent = 
        `Completed on: ${new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`;
      modal.classList.remove('hidden');
    }

    document.getElementById('closeCertificateBtn').addEventListener('click', () => {
      document.getElementById('certificateModal').classList.add('hidden');
    });

    init();
  </script>
</body>
</html>
